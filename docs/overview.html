<html>
<head><title>Gluecodium Architecture</title></head>
<body>
<h1>Gluecodium Architecture</h1>

<h2>Generator Data Flow</h2>
The generation starts with a list of Franca files, and streams the data through multiple steps before producing the
final output.

<div align="center"><object type="image/svg+xml" data="gluecodium_flow.svg"></object></div>

<h2>{@linkplain com.here.gluecodium.loader.FrancaModelLoader Loader}</h2>
These components take care of loading the IDL and Deploy files. All imports are resolved by the Franca framework, and we
make sure default SpecAccessors (BaseApiSpec.fidl) are available for all Model elements.

<h2>Language Independent Model</h2>
These components are mostly based directly on Franca framework types, and contain little additional structure. During
this step some meta data for the Generators is prepared.

<h2>{@linkplain com.here.gluecodium.platform.common.GeneratorSuite Generator Suites}</h2>
The Model is passed to all selected/available Generator Suites. These will combine multiple Generators to build a API
layer. The current suites are
<ul>
    <li>{@link com.here.gluecodium.platform.baseapi.BaseApiGeneratorSuite}</li>
    <li>{@link com.here.gluecodium.platform.android.AndroidGeneratorSuite}</li>
    <li>{@link com.here.gluecodium.platform.swift.SwiftGeneratorSuite}</li>
</ul>

<h2><a href="{@docRoot}/com/here/ivi/api/validator/package-summary.html">Validator</a></h2>
The model is validated to find unsupported combinations of features (for example static functions in interfaces which
are marked as IsInterface and become a Java Interface or Swift protocol)

<h2>Generator</h2>
The generators use the model to create target language models for one or more target files. The generator uses an event
driven tree walker of the language independent model to build the model of the target language. Usually this happens in
a separate model builder.

<h2>Language Model</h2>
The language model is similar to the AST of the target language, also containing information necessary to do type
conversions etc.

<h2>Templates</h2>
The templates are written in Trimou and used to convert the model into source files of the target language. This is done
by the {@link com.here.gluecodium.generator.common.templates.TemplateEngine TemplateEngine}.

<h2>Output</h2>
Finally the produced instance of the templates is put through an
<a href="{@docRoot}/com/here/ivi/api/output/package-summary.html">output layer</a>, to e.g. save it on the file system.

@startuml gluecodium_flow.svg
digraph GluecodiumFlow {
    rankdir = LR
    colorscheme = SVG
    node [
        shape = cds
        style = filled
    ]

    subgraph clusterLegend {
        label = "Legend"
        node [ shape = box ]
        "Franca library\n(3rd party)" [ fillcolor = lightsteelblue ]
        "Tool level\n(outside of individual generators)" [ fillcolor = khaki ]
        "Generator level\n(inside generators)" [ fillcolor = darkseagreen ]
    }


    Input [
        label = "FIDL Files"
        shape = cylinder
    ]

    {
        node [ fillcolor = lightsteelblue ]
        Loader []
        FrancaModel [
            label = "Language\nIndependent\nModel"
        ]
    }

    {
        node [ fillcolor = khaki ]
        "Generator Suite" []
        Validator []

        subgraph clusterGenerator {
            label = "Generator"
            fillcolor = khaki
            style = filled

            node [ fillcolor = darkseagreen ]
            "Model Builder" -> "Language Model" -> Template
        }
    }

    Output [
        label = "Generated Files"
        shape = cylinder
    ]
    Input -> Loader -> FrancaModel -> Validator -> "Generator Suite" -> "Model Builder"
    Template -> Output
}
@enduml
</body>
</html>
